@page "/login"
@inject IJSRuntime Js


<PageTitle>Login</PageTitle>

<h1>Login</h1>

<br/>

<div class="container">
    <h3>Email</h3>
    <input type="text" @bind="userEmail" class="form-control" autofocus required />

    <h3>Password</h3>
    <input type="text" @bind="userPassword" class="form-control" required />
    
    <br/>
    <br/>
    <button
        type="button"
        class="btn btn-primary"
        @onclick="AttemptLogin">
        Login
    </button>
</div>

<script>
    window.setCookie = (name, value) => {
        const d = new Date();
        d.setTime(d.getTime() + (24 * 60 * 60 * 1000)); // 1 day
        let expires = "expires=" + d.toUTCString();
        document.cookie = name + "=" + value + ";" + expires + ";path=/"; // Use parameters correctly
    };
</script>

@code {
    
    private string userEmail;
    private string userPassword;
    
    [Inject] NavigationManager Navigation { get; set; }
    
    // Set cookie if auth'd
    public async Task AttemptLogin()
    {
        if (User.IsAuthenticated(userEmail, userPassword))
        {
            // TODO: set cookie
            // https://learn.microsoft.com/en-us/aspnet/core/security/authentication/cookie?view=aspnetcore-8.0&viewFallbackFrom=aspnetcore-2.1&tabs=aspnetcore2x
            Console.WriteLine("USER IS AUTHENTICATED");
            await sendCookie("access_token", userEmail);
        }
        Console.WriteLine("NOT AUTHENTICATED");
        BackHome();
    }
    
    public async Task sendCookie(string name, string value)
    {
        await Js.InvokeVoidAsync("setCookie", "access_token", userEmail);
    }
    
    // redirect
    public void BackHome()
    {
        Navigation.NavigateTo("/");
    }
}